# 云瑶家庭空气监控系统
# 毕业设计——基于STM32的室内空气监控系统设计与实现
### 摘要
    基于STM32的室内空气监控系统是由STM32F103C8T6单片机，多种传感器组成的智能监控系统。通过嵌入式相关技术、WiFi通信、MQTT协议开发设备端，以OneNET云平台作为服务器，基于微信小程序开发用户端，实现本智能监控系统。本系统可持续监测室内的温湿度、可燃气体、PM2.5等空气参数，并将采集数据通过OLED显示屏展示。同时，所采集数据通过MQTT协议上传OneNET云平台下的MQTT服务器。用户可通过微信小程序查看设备端空气参数数据和设备状态，以及远程控制设备端的警报器和通风机，方便用户及时获得室内空气质量状况并进行干预以解决潜在危险。本系统设计通过运行和调试，可以稳定地进行室内空气监控，并实现数据可视化，具有一定的应用价值和市场前景。 
### 关键词：STM32F103C8T6；室内空气监控系统；室内空气监测系统

### 具体功能
（1）设备端通过传感器采集室内空气参数数据，包括温湿度、可燃气体浓度、PM2.5浓度。当任一种采集到的空气参数数据超过设置的安全值时，系统将进行报警通知用户，同时打开通风机进行通风。设备端默认为自动报警模式，用户可在设备端按下按键切换为手动报警模式，经过10秒后会再次切换为自动报警模式。
（2）传感器采集的空气参数数据实时更新并显示在OLED显示屏上。
（3）设备端具有三个控制按键，按键一为警报器开关，按键二为通风机开关，按键三可以切换通风机的模式，即控制向外排风模式和向内送风模式的切换。
（4）设备端通过WIFI通信模块接入网络，利用MQTT协议将数据上传至OneNET云平台多协议接入服务下的MQTT服务器，OneNET云平台的服务器的数据存储有效期为一个月。用户端微信小程序可通过API接口从该服务器中获取数据，获取得到的JSON格式数据经过解析处理后渲染到小程序页面，实时显示室内空气参数数据和硬件设备状态。
（5）用户可以通过微信小程序的开关组件，下发控制命令至OneNET云平台的MQTT服务器，经过该服务器发布订阅，设备端接收到订阅后，经解析得到控制信息，并执行相应的操作，包括警报器的开启关闭和通风机的开启关闭、正转反转。
（6）在微信小程序的服务页面中，用户可以根据个人生活习惯在系统提供的安全值范围中选择合适的值，并下发给设备端作为报警阈值。可使用系统默认的安全值设置。
（7）用户注册微信小程序账号时，需要填写用户名、手机号码和密码，同时可以绑定设备端的唯一设备号。，绑定设备号为非强制动作，用户可以在登录后，再进行绑定设备号或者修改设备号以绑定新设备。绑定了同一设备号的微信小程序用户会被视为设备共享人。
（8）用户端微信小程序会获取用户所在地理信息，通过API接口获取和风天气的城市天气服务，显示包括今日天气、气温、相对湿度、风向、风力、风速、当前小时降水量、大气压强、能见度的天气信息。
（9）用户端微信小程序的每一个空气参数的功能页面中，会默认显示当日数据折线图，折线图绘制信息为当日的最大值和平均值。用户可以在日历组件选择日期查看指定历史数据，同样会绘制数据折线图。同时在该页面中，会默认显示当日和当前小时的空气参数数据最大值和平均值，点击折线图可以查询得到某一小时的最大值和平均值。
（10）用户可以在微信小程序的消息通知页面查看最近十条间隔一分钟以上的报警信息，信息包括报警日期时间，空气参数数据和设备状态。

-----------------------------------------------------------------------------

# 使用该项目需要：
## 引入Vant  
-  https://youzan.github.io/vant-weapp/#/home
## 使用阿里巴巴矢量图标库 
-  https://www.iconfont.cn/

# 另外使用了小程序云开发的数据库进行存储用户数据
## 这是云开发的快速启动指引，其中演示了如何上手使用云开发的三大基础能力：
- 数据库：一个既可在小程序前端操作，也能在云函数中读写的 JSON 文档型数据库
- 文件存储：在小程序前端直接上传/下载云端文件，在云开发控制台可视化管理
- 云函数：在云端运行的代码，微信私有协议天然鉴权，开发者只需编写业务逻辑代码
## 参考文档
- [云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)

